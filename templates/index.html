<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Empowering turmeric farmers in Nizamabad with fair trading, blockchain technology, and market transparency for all turmeric varieties">
    <meta name="theme-color" content="#667eea">
    <link rel="manifest" href="/static/manifest.json">
    <title>{{ _('TurmericTech - Fair Turmeric Trading Platform') }}</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Chart.js for data visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <header class="modern-navbar">
        <div class="navbar-container">
            <!-- Logo and Brand Section -->
            <div class="navbar-brand-section">
                <div class="brand-logo">
                    <i class="fas fa-seedling brand-icon"></i>
                    <div class="brand-text">
                        <h1 class="brand-title">TurmericTech</h1>
                        <span class="brand-subtitle">Fair Trading</span>
                    </div>
                </div>
            </div>

            <!-- Main Navigation -->
            <nav class="main-navigation">
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a href="#home" class="nav-link active" data-tooltip="Home">
                            <i class="fas fa-home nav-icon"></i>
                            <span class="nav-text">{{ _('Home') }}</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#market" class="nav-link" data-tooltip="Market Prices">
                            <i class="fas fa-chart-line nav-icon"></i>
                            <span class="nav-text">{{ _('Markets') }}</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#trade" class="nav-link" data-tooltip="Fair Trade">
                            <i class="fas fa-handshake nav-icon"></i>
                            <span class="nav-text">{{ _('Trade') }}</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#cooperative" class="nav-link" data-tooltip="Cooperatives">
                            <i class="fas fa-users nav-icon"></i>
                            <span class="nav-text">{{ _('Cooperatives') }}</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#blockchain" class="nav-link" data-tooltip="Blockchain">
                            <i class="fas fa-link nav-icon"></i>
                            <span class="nav-text">{{ _('Blockchain') }}</span>
                        </a>
                    </li>
                </ul>
            </nav>

            <!-- User Actions & Mobile Menu -->
            <div class="navbar-actions">
                <div class="user-section">
                    {% if session.user %}
                    <div class="user-menu">
                        <button class="user-btn" id="userMenuBtn">
                            <i class="fas fa-user-circle user-icon"></i>
                            <span class="user-name">{{ session.user }}</span>
                            <i class="fas fa-chevron-down dropdown-icon"></i>
                        </button>
                        <div class="user-dropdown" id="userDropdown">
                            <a href="{{ url_for('farmer_profile') }}" class="dropdown-item">
                                <i class="fas fa-user"></i> {{ _('My Profile') }}
                            </a>
                            <a href="{{ url_for('impact_dashboard') }}" class="dropdown-item">
                                <i class="fas fa-chart-bar"></i> {{ _('Analytics') }}
                            </a>
                            <div class="dropdown-divider"></div>
                            <a href="{{ url_for('logout') }}" class="dropdown-item logout">
                                <i class="fas fa-sign-out-alt"></i> {{ _('Logout') }}
                            </a>
                        </div>
                    </div>
                    {% else %}
                    <a href="{{ url_for('login') }}" class="login-btn">
                        <i class="fas fa-sign-in-alt"></i>
                        <span>{{ _('Login') }}</span>
                    </a>
                    {% endif %}
                </div>

                <!-- Mobile Menu Toggle -->
                <button class="mobile-menu-toggle" id="mobileMenuToggle">
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                </button>
            </div>
        </div>

        <!-- Mobile Navigation Overlay -->
        <div class="mobile-nav-overlay" id="mobileNavOverlay">
            <div class="mobile-nav-content">
                <div class="mobile-nav-header">
                    <div class="mobile-brand">
                        <i class="fas fa-seedling"></i>
                        <span>TurmericTech</span>
                    </div>
                    <button class="mobile-nav-close" id="mobileNavClose">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <ul class="mobile-nav-menu">
                    <li class="mobile-nav-item">
                        <a href="#home" class="mobile-nav-link">
                            <i class="fas fa-home"></i>
                            <span>{{ _('Home') }}</span>
                        </a>
                    </li>
                    <li class="mobile-nav-item">
                        <a href="#market" class="mobile-nav-link">
                            <i class="fas fa-chart-line"></i>
                            <span>{{ _('Market Prices') }}</span>
                        </a>
                    </li>
                    <li class="mobile-nav-item">
                        <a href="#trade" class="mobile-nav-link">
                            <i class="fas fa-handshake"></i>
                            <span>{{ _('Fair Trade') }}</span>
                        </a>
                    </li>
                    <li class="mobile-nav-item">
                        <a href="#cooperative" class="mobile-nav-link">
                            <i class="fas fa-users"></i>
                            <span>{{ _('Cooperatives') }}</span>
                        </a>
                    </li>
                    <li class="mobile-nav-item">
                        <a href="#blockchain" class="mobile-nav-link">
                            <i class="fas fa-link"></i>
                            <span>{{ _('Blockchain') }}</span>
                        </a>
                    </li>
                    {% if session.user %}
                    <li class="mobile-nav-item">
                        <a href="{{ url_for('farmer_profile') }}" class="mobile-nav-link">
                            <i class="fas fa-user"></i>
                            <span>{{ _('My Profile') }}</span>
                        </a>
                    </li>
                    <li class="mobile-nav-item">
                        <a href="{{ url_for('impact_dashboard') }}" class="mobile-nav-link">
                            <i class="fas fa-chart-bar"></i>
                            <span>{{ _('Analytics') }}</span>
                        </a>
                    </li>
                    <li class="mobile-nav-item">
                        <a href="{{ url_for('logout') }}" class="mobile-nav-link logout">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>{{ _('Logout') }}</span>
                        </a>
                    </li>
                    {% else %}
                    <li class="mobile-nav-item">
                        <a href="{{ url_for('login') }}" class="mobile-nav-link login">
                            <i class="fas fa-sign-in-alt"></i>
                            <span>{{ _('Login') }}</span>
                        </a>
                    </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </header>

    <main class="container my-5">
        <section id="home" class="hero-section text-center mb-5">
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <h2 class="display-4 mb-4 text-primary">
                        <i class="fas fa-seedling farm-icon"></i>
                        {{ _('Welcome to Fair Turmeric Trading') }}
                    </h2>
                    <p class="lead mb-4 text-muted">{{ _('Eliminate middlemen exploitation with transparent turmeric pricing, secure blockchain transactions, and cooperative farming power for all turmeric varieties.') }}</p>
                    <div class="row g-4 justify-content-center">
                        <div class="col-md-4">
                            <div class="stat-card p-4 rounded shadow-sm">
                                <i class="fas fa-users fa-2x mb-3 text-success"></i>
                                <h3 class="text-primary">150+</h3>
                                <p class="mb-0">{{ _('Registered Farmers') }}</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="stat-card p-4 rounded shadow-sm">
                                <i class="fas fa-rupee-sign fa-2x mb-3 text-warning"></i>
                                <h3 class="text-primary">₹2.5L</h3>
                                <p class="mb-0">{{ _('Fair Trade Volume') }}</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="stat-card p-4 rounded shadow-sm">
                                <i class="fas fa-shield-alt fa-2x mb-3 text-primary"></i>
                                <h3 class="text-primary">99.9%</h3>
                                <p class="mb-0">{{ _('Transaction Security') }}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="market" class="market-section bg-light p-4 rounded shadow mb-5">
            <h2 class="text-center mb-4 text-primary">
                <i class="fas fa-chart-line farm-icon"></i>
                {{ _('Live Turmeric Market Prices & Trading Chart') }}
            </h2>
            <div class="market-info">
                <div class="row mb-4">
                    <div class="col-lg-8">
                        <div class="chart-container">
                            <canvas id="priceChart" width="400" height="200"></canvas>
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <div class="price-indicators">
                            <div class="indicator-card mb-3">
                                <h5 class="text-primary mb-3">
                                    <i class="fas fa-tachometer-alt"></i> Market Indicators
                                </h5>
                                <div class="indicator-item d-flex justify-content-between align-items-center mb-2">
                                    <span class="indicator-label">24h Change:</span>
                                    <span id="change-24h" class="indicator-value text-success">+2.5%</span>
                                </div>
                                <div class="indicator-item d-flex justify-content-between align-items-center mb-2">
                                    <span class="indicator-label">Volume:</span>
                                    <span id="volume" class="indicator-value">1,250 kg</span>
                                </div>
                                <div class="indicator-item d-flex justify-content-between align-items-center mb-2">
                                    <span class="indicator-label">High:</span>
                                    <span id="high" class="indicator-value text-success">₹285</span>
                                </div>
                                <div class="indicator-item d-flex justify-content-between align-items-center mb-2">
                                    <span class="indicator-label">Low:</span>
                                    <span id="low" class="indicator-value text-danger">₹265</span>
                                </div>
                            </div>
                            <div class="trading-controls">
                                <h6 class="text-primary mb-3">
                                    <i class="fas fa-cog"></i> Quick Actions
                                </h6>
                                <button id="refresh-chart" class="btn btn-outline-primary btn-sm w-100 mb-2">
                                    <i class="fas fa-sync-alt"></i> Refresh Data
                                </button>
                                <button onclick="window.location.href='{{ url_for('impact_dashboard') }}'" class="btn btn-primary btn-sm w-100">
                                    <i class="fas fa-chart-bar"></i> View Analytics
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <p id="last-updated" class="text-center text-muted mb-4">{{ _('Loading latest prices...') }}</p>
                <div class="row g-3" id="prices">
                    <!-- Prices will be loaded here -->
                </div>
            </div>
        </section>

        <section id="trade" class="trade-section bg-white p-4 rounded shadow mb-5">
            <h2 class="text-center mb-4 text-primary">
                <i class="fas fa-handshake farm-icon"></i>
                {{ _('Initiate Fair Turmeric Trade') }}
            </h2>

            <!-- Trade Overview Cards -->
            <div class="row g-3 mb-4">
                <div class="col-md-3">
                    <div class="trade-stat-card p-3 text-center">
                        <i class="fas fa-chart-line fa-2x mb-2 text-success"></i>
                        <h4 class="mb-1" id="current-market-price">₹275</h4>
                        <small class="text-muted">Market Price/kg</small>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="trade-stat-card p-3 text-center">
                        <i class="fas fa-balance-scale fa-2x mb-2 text-primary"></i>
                        <h4 class="mb-1" id="fair-price-suggestion">₹265</h4>
                        <small class="text-muted">Fair Trade Price</small>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="trade-stat-card p-3 text-center">
                        <i class="fas fa-users fa-2x mb-2 text-warning"></i>
                        <h4 class="mb-1" id="active-trades">12</h4>
                        <small class="text-muted">Active Trades</small>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="trade-stat-card p-3 text-center">
                        <i class="fas fa-shield-alt fa-2x mb-2 text-info"></i>
                        <h4 class="mb-1">99.9%</h4>
                        <small class="text-muted">Success Rate</small>
                    </div>
                </div>
            </div>

            <!-- Trade Type Selection -->
            <div class="trade-type-selector mb-4">
                <div class="btn-group w-100" role="group">
                    <input type="radio" class="btn-check" name="tradeType" id="direct-trade" autocomplete="off" checked>
                    <label class="btn btn-outline-primary" for="direct-trade">
                        <i class="fas fa-handshake"></i> Direct Trade
                    </label>
                    <input type="radio" class="btn-check" name="tradeType" id="auction-trade" autocomplete="off">
                    <label class="btn btn-outline-primary" for="auction-trade">
                        <i class="fas fa-gavel"></i> Auction
                    </label>
                    <input type="radio" class="btn-check" name="tradeType" id="contract-trade" autocomplete="off">
                    <label class="btn btn-outline-primary" for="contract-trade">
                        <i class="fas fa-file-contract"></i> Contract
                    </label>
                </div>
            </div>

            <form id="trade-form" class="trade-form">
                <div class="row g-3">
                    <!-- Turmeric Variety Selection -->
                    <div class="col-md-6">
                        <label for="turmeric_type" class="form-label">
                            <i class="fas fa-seedling text-success"></i> Turmeric Variety <span class="text-danger">*</span>
                        </label>
                        <select id="turmeric_type" class="form-select" required>
                            <option value="" disabled selected>Choose variety...</option>
                            <option value="alleppey" data-quality="premium" data-region="Kerala">Alleppey Turmeric (Premium)</option>
                            <option value="erode" data-quality="standard" data-region="Tamil Nadu">Erode Turmeric (Standard)</option>
                            <option value="nizamabad" data-quality="organic" data-region="Telangana">Nizamabad Local (Organic)</option>
                            <option value="rajapore" data-quality="premium" data-region="Maharashtra">Rajapore Turmeric (Premium)</option>
                            <option value="duggirala" data-quality="standard" data-region="Andhra Pradesh">Duggirala Turmeric (Standard)</option>
                            <option value="other" data-quality="standard" data-region="Other">Other Variety</option>
                        </select>
                        <div class="form-text" id="variety-info"></div>
                    </div>

                    <!-- Quality Grade -->
                    <div class="col-md-6">
                        <label for="quality_grade" class="form-label">
                            <i class="fas fa-award text-warning"></i> Quality Grade <span class="text-danger">*</span>
                        </label>
                        <select id="quality_grade" class="form-select" required>
                            <option value="" disabled selected>Select quality...</option>
                            <option value="premium">Premium Grade (A+)</option>
                            <option value="standard">Standard Grade (A)</option>
                            <option value="basic">Basic Grade (B)</option>
                        </select>
                        <div class="form-text" id="quality-info"></div>
                    </div>

                    <!-- Quantity -->
                    <div class="col-md-6">
                        <label for="quantity" class="form-label">
                            <i class="fas fa-weight text-primary"></i> Quantity (kg) <span class="text-danger">*</span>
                        </label>
                        <div class="input-group">
                            <input type="number" id="quantity" class="form-control" min="1" max="10000" required>
                            <span class="input-group-text">kg</span>
                        </div>
                        <div class="form-text" id="quantity-info"></div>
                    </div>

                    <!-- Price -->
                    <div class="col-md-6">
                        <label for="price" class="form-label">
                            <i class="fas fa-rupee-sign text-success"></i> Agreed Price (₹/kg) <span class="text-danger">*</span>
                        </label>
                        <div class="input-group">
                            <span class="input-group-text">₹</span>
                            <input type="number" id="price" class="form-control" min="1" step="0.01" required>
                            <span class="input-group-text">/kg</span>
                        </div>
                        <div class="form-text" id="price-info">
                            <span id="price-suggestion" class="text-primary"></span>
                        </div>
                    </div>

                    <!-- Buyer Information -->
                    <div class="col-md-6">
                        <label for="buyer_type" class="form-label">
                            <i class="fas fa-user-tag text-info"></i> Buyer Type <span class="text-danger">*</span>
                        </label>
                        <select id="buyer_type" class="form-select" required>
                            <option value="" disabled selected>Select buyer type...</option>
                            <option value="cooperative">Farmer Cooperative</option>
                            <option value="exporter">Export Company</option>
                            <option value="processor">Processing Unit</option>
                            <option value="retailer">Retail Buyer</option>
                            <option value="wholesaler">Wholesale Trader</option>
                        </select>
                    </div>

                    <div class="col-md-6">
                        <label for="buyer" class="form-label">
                            <i class="fas fa-id-card text-info"></i> Buyer ID / Contact <span class="text-danger">*</span>
                        </label>
                        <input type="text" id="buyer" class="form-control" placeholder="Enter buyer identifier or contact" required>
                        <div class="form-text">Use buyer ID or phone number for verification</div>
                    </div>

                    <!-- Delivery Information -->
                    <div class="col-md-6">
                        <label for="delivery_date" class="form-label">
                            <i class="fas fa-calendar text-warning"></i> Delivery Date <span class="text-danger">*</span>
                        </label>
                        <input type="date" id="delivery_date" class="form-control" required>
                    </div>

                    <div class="col-md-6">
                        <label for="delivery_location" class="form-label">
                            <i class="fas fa-map-marker-alt text-danger"></i> Delivery Location
                        </label>
                        <input type="text" id="delivery_location" class="form-control" placeholder="Farm location or delivery address">
                    </div>

                    <!-- Trade Terms -->
                    <div class="col-12">
                        <label for="trade_terms" class="form-label">
                            <i class="fas fa-file-contract text-secondary"></i> Trade Terms & Conditions
                        </label>
                        <textarea id="trade_terms" class="form-control" rows="3" placeholder="Specify payment terms, quality standards, delivery conditions..."></textarea>
                        <div class="form-text">Optional: Add specific terms for this trade agreement</div>
                    </div>
                </div>

                <!-- Trade Summary -->
                <div id="trade-summary" class="trade-summary mt-4 p-3 bg-light rounded" style="display: none;">
                    <h5 class="text-primary mb-3">
                        <i class="fas fa-calculator"></i> Trade Summary
                    </h5>
                    <div class="row g-2">
                        <div class="col-md-6">
                            <strong>Total Value:</strong> <span id="total-value" class="text-success">₹0</span>
                        </div>
                        <div class="col-md-6">
                            <strong>Market Alignment:</strong> <span id="market-alignment" class="badge bg-success">Fair Price</span>
                        </div>
                        <div class="col-md-6">
                            <strong>Quality Premium:</strong> <span id="quality-premium">₹0</span>
                        </div>
                        <div class="col-md-6">
                            <strong>Estimated Profit:</strong> <span id="estimated-profit" class="text-success">₹0</span>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="text-center mt-4">
                    <button type="button" id="preview-trade" class="btn btn-outline-primary me-2">
                        <i class="fas fa-eye"></i> Preview Trade
                    </button>
                    <button type="submit" class="btn btn-primary btn-lg">
                        <i class="fas fa-paper-plane"></i> Create Blockchain Transaction
                    </button>
                </div>
            </form>

            <!-- Trade Preview Modal -->
            <div class="modal fade" id="tradePreviewModal" tabindex="-1">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">
                                <i class="fas fa-file-contract"></i> Trade Agreement Preview
                            </h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body" id="trade-preview-content">
                            <!-- Preview content will be populated by JavaScript -->
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Edit</button>
                            <button type="button" id="confirm-trade" class="btn btn-primary">
                                <i class="fas fa-check"></i> Confirm & Create Trade
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="transaction-status" class="transaction-status mt-3"></div>
        </section>

        <section id="cooperative" class="cooperative-section bg-white p-4 rounded shadow mb-5">
            <h2 class="text-center mb-4 text-primary">
                <i class="fas fa-users farm-icon"></i>
                {{ _('Turmeric Farmer Cooperatives') }}
            </h2>
            <div class="row g-4">
                <div class="col-lg-6">
                    <div class="cooperative-card p-4 h-100">
                        <h3 class="text-primary mb-3">{{ _('Nizamabad Turmeric Collective') }}</h3>
                        <p class="mb-3">{{ _('250+ members, specializing in premium turmeric varieties and organic farming practices') }}</p>
                        <button class="btn btn-outline-primary" data-href="{{ url_for('cooperatives') }}" onclick="window.location.href=this.dataset.href">{{ _('View Details') }}</button>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="cooperative-card p-4 h-100">
                        <h3 class="text-primary mb-3">{{ _('Telangana Turmeric Alliance') }}</h3>
                        <p class="mb-3">{{ _('Regional cooperative focused on fair pricing and quality turmeric export') }}</p>
                        <button class="btn btn-outline-primary" data-href="{{ url_for('cooperatives') }}" onclick="window.location.href=this.dataset.href">{{ _('View Details') }}</button>
                    </div>
                </div>
            </div>
        </section>

        <section id="blockchain" class="blockchain-section bg-white p-4 rounded shadow mb-5">
            <h2 class="text-center mb-4 text-primary">
                <i class="fas fa-link farm-icon"></i>
                {{ _('Turmeric Blockchain Transparency') }}
            </h2>
            <div class="blockchain-info text-center">
                <p class="mb-4">{{ _('All turmeric transactions are recorded on our secure blockchain, ensuring transparency and preventing fraud in the turmeric supply chain.') }}</p>
                <div class="row g-4 justify-content-center mb-4">
                    <div class="col-md-4">
                        <div class="block-stat p-3 bg-light rounded">
                            <h3 id="block-count" class="text-primary mb-2">1</h3>
                            <p class="mb-0">{{ _('Blocks Mined') }}</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="block-stat p-3 bg-light rounded">
                            <h3 id="transaction-count" class="text-primary mb-2">0</h3>
                            <p class="mb-0">{{ _('Transactions') }}</p>
                        </div>
                    </div>
                </div>
                <button id="mine-block" class="btn btn-primary btn-lg">{{ _('Mine New Block') }}</button>
                <div id="mining-status" class="mining-status mt-3"></div>
                <div class="text-center mt-3">
                    <a href="{{ url_for('verify_qr_page', batch_id='demo') }}" class="btn btn-outline-success">
                        <i class="fas fa-qrcode"></i> Verify Product QR Code
                    </a>
                </div>
            </div>
        </section>
    </main>

    <footer class="main-footer">
        <div class="container">
            <p>{{ _('© 2025 TurmericTech Platform - Building Fair Turmeric Trading') }}</p>
            <div class="footer-links">
                <a href="#">{{ _('Privacy Policy') }}</a>
                <a href="#">{{ _('Terms of Service') }}</a>
                <a href="#">{{ _('Contact Us') }}</a>
            </div>
        </div>
    </footer>

    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Chatbot Widget -->
    <div id="chat-widget" class="chat-widget">
        <div class="chat-toggle" onclick="toggleChat()">
            <i class="fas fa-comments"></i>
        </div>
        <div class="chat-container" id="chat-container">
            <div class="chat-header">
                <h5><i class="fas fa-robot"></i> AgriBot Assistant</h5>
                <button class="btn-close" onclick="toggleChat()"></button>
            </div>
            <div class="chat-messages" id="chat-messages">
                <div class="message bot-message">
                    <div class="message-content">
                        Hello! I'm your agricultural assistant. I can help you with farming tips, crop information, market prices, and more. How can I assist you today?
                    </div>
                </div>
            </div>
            <div class="chat-input">
                <input type="text" id="chat-input" placeholder="Ask me anything about farming..." onkeypress="handleKeyPress(event)">
                <button onclick="sendMessage()" class="btn btn-primary">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

    <script>
        function toggleChat() {
            const container = document.getElementById('chat-container');
            container.classList.toggle('active');
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        async function sendMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            if (!message) return;

            // Add user message
            addMessage(message, 'user');
            input.value = '';

            // Show typing indicator
            showTyping();

            try {
                const response = await fetch('/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ message: message })
                });

                const data = await response.json();
                hideTyping();

                if (response.ok) {
                    await typeMessage(data.response, 'bot');
                } else {
                    await typeMessage('Sorry, I encountered an error. Please try again.', 'bot');
                }
            } catch (error) {
                hideTyping();
                await typeMessage('Sorry, I\'m having trouble connecting. Please check your internet connection.', 'bot');
            }
        }

        function addMessage(content, type) {
            const messages = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}-message`;
            messageDiv.innerHTML = `<div class="message-content">${content}</div>`;
            messages.appendChild(messageDiv);
            messages.scrollTop = messages.scrollHeight;
        }

        async function typeMessage(content, type) {
            const messages = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}-message`;
            const messageContent = document.createElement('div');
            messageContent.className = 'message-content typing';
            messageDiv.appendChild(messageContent);
            messages.appendChild(messageDiv);

            // Type each character with a delay
            let index = 0;
            const typingSpeed = 30; // milliseconds per character

            return new Promise((resolve) => {
                function typeNextChar() {
                    if (index < content.length) {
                        messageContent.textContent += content[index];
                        index++;
                        messages.scrollTop = messages.scrollHeight;
                        setTimeout(typeNextChar, typingSpeed);
                    } else {
                        // Remove typing class when done
                        messageContent.classList.remove('typing');
                        resolve();
                    }
                }
                typeNextChar();
            });
        }

        function showTyping() {
            const messages = document.getElementById('chat-messages');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message bot-message typing';
            typingDiv.id = 'typing-indicator';
            typingDiv.innerHTML = `
                <div class="message-content">
                    <div class="typing-dots">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </div>
            `;
            messages.appendChild(typingDiv);
            messages.scrollTop = messages.scrollHeight;
        }

        function hideTyping() {
            const typing = document.getElementById('typing-indicator');
            if (typing) typing.remove();
        }
    </script>
</body>
</html>